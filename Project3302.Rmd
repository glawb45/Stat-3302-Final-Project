---
title: "Holy Crop"
output: html_document
date: "2024-03-23"
---

```{r setup, include=FALSE}
# Get the Data
key_crop_yields <- read_csv('key_crop_yields.csv')
fertilizer <- read_csv('cereal_crop_yield_vs_fertilizer_application.csv')
land_use <- read_csv('land_use_vs_yield_change_in_cereal_production.csv')
arable_land <- read_csv('arable_land_pin.csv')
```

# Fertilizer
```{r}
fert <- fertilizer %>%
  filter(Year %in% 2002:2013) %>%
  filter(Entity %in% c("Africa", "Americas", "Asia", "Australia & New Zealand", "Caribbean", "Central America", "Eastern Africa", "Eastern Asia", "Eastern Europe", "Europe", "Europe, Western", "Micronesia (region)", "Middle Africa", "Northern Africa", "Northern America", "Oceania", "South America", "South Eastern Asia", "Southern Africa", "Southern Asia", "Southern Europe", "Western Africa", "Western Asia"))
fert <-  mutate(fert, Entity = ifelse(Entity == "Europe, Western", "Western Europe", Entity)) %>%
  group_by(Year, Entity) %>%
  summarize(yield = `Cereal yield (tonnes per hectare)`, fertilizer = `Nitrogen fertilizer use (kilograms per hectare)`)

fert[is.na(fert)] <- 0
```

Arable Land

```{r}
air <- arable_land %>%
  filter(Year %in% 1995:2014) %>%
  filter(Entity %in% c("Africa", "Americas", "Asia", "Australia & New Zealand", "Caribbean", "Central America", "Eastern Africa", "Eastern Asia", "Eastern Europe", "Europe", "Western Europe", "Micronesia (region)", "Middle Africa", "Northern Africa", "Northern America", "Oceania", "South America", "South-Eastern Asia", "Southern Africa", "Southern Asia", "Southern Europe", "Western Africa", "Western Asia")) %>%
  mutate(air, Entity = ifelse(Entity == "South-Eastern Asia", "South Eastern Asia", Entity)) %>%
  group_by(Year, Entity) %>%
  summarize(arable_land = `Arable land needed to produce a fixed quantity of crops ((1.0 = 1961))`)
```

Key Crops

```{r}
crop <- key_crop %>%
  filter(Year %in% 1995:2014) %>%
  filter(Entity %in% c("Africa", "Americas", "Asia", "Australia & New Zealand", "Caribbean", "Central America", "Eastern Africa", "Eastern Asia", "Eastern Europe", "Europe", "Europe, Western", "Micronesia (region)", "Middle Africa", "Northern Africa", "Northern America", "Oceania", "South America", "South-Eastern Asia", "Southern Africa", "Southern Asia", "Southern Europe", "Western Africa", "Western Asia")) %>%
  mutate(crop, Entity = ifelse(Entity == "Europe, Western", "Western Europe", Entity)) %>%
  mutate(crop, Entity = ifelse(Entity == "South-Eastern Asia", "South Eastern Asia", Entity)) %>%
  group_by(Year, Entity) %>%
  summarize(wheat = `Wheat (tonnes per hectare)`,
            rice = `Rice (tonnes per hectare)`,
            maize = `Maize (tonnes per hectare)`,
            soybeans = `Soybeans (tonnes per hectare)`,
            potatoes = `Potatoes (tonnes per hectare)`,
            beans = `Beans (tonnes per hectare)`,
            peas = `Peas (tonnes per hectare)`,
            cassava = `Cassava (tonnes per hectare)`,
            barley = `Barley (tonnes per hectare)`,
            cocoa_beans = `Cocoa beans (tonnes per hectare)`,
            bananas = `Bananas (tonnes per hectare)`)
crop[is.na(crop)] <- 0
```

```{r}
crop <- crop %>% summarize(Entity,
            wheat,
            rice,
            maize,
            soybeans,
            potatoes,
            beans,
            peas,
            cassava,
            barley,
            cocoa_beans,
            bananas, 
            total = wheat+rice+maize+soybeans+potatoes+beans+peas+cassava+barley+cocoa_beans+bananas)

```

```{r}
df_crop = data.frame(Year = crop$Year, Entity = crop$Entity, wheat = crop$wheat, rice = crop$rice, maize = crop$maize, soybeans = crop$soybeans, potatoes = crop$potatoes, beans = crop$beans, peas = crop$peas, cassava = crop$cassava, barley = crop$barley, cocoa = crop$cocoa_beans, bananas = crop$bananas, total = round(crop$total))
df_fert = data.frame(Year = fert$Year, Entity = fert$Entity, fertilizer = fert$fertilizer)
df_air = data.frame(Year = air$Year, Entity = air$Entity, land = air$arable_land)
merged_data = full_join(df_crop, df_fert)
merged_data = full_join(merged_data, df_air)
merged_data[is.na(merged_data)] <- 0
```

```{r}
yield_glm = glm(round(wheat) ~ Entity + Year + fertilizer, family = 'poisson', data = merged_data)
summary(yield_glm)
yield_glm = glm(round(wheat) ~ Year + fertilizer, family = 'poisson', data = merged_data)
summary(yield_glm)
yield_glm = glm(round(wheat) ~ Entity + Year + fertilizer + land, family = 'poisson', data = merged_data)
summary(yield_glm)
yield_glm = glm(round(rice) ~ Entity + Year + fertilizer, family = 'poisson', data = merged_data)
summary(yield_glm)
yield_glm = glm(round(rice) ~ Year + fertilizer, family = 'poisson', data = merged_data)
summary(yield_glm)
yield_glm = glm(round(rice) ~ Entity + Year + fertilizer + land, family = 'poisson', data = merged_data)
summary(yield_glm)
yield_glm = glm(round(rice) ~ Year + land + fertilizer*wheat, family = 'poisson', data = merged_data)
summary(yield_glm)
yield_glm = glm(round(rice) ~ Year + fertilizer + wheat + land, family = 'poisson', data = merged_data)
summary(yield_glm)
```

### Data Visuals

```{r, cache=TRUE}
ggplot(merged_data, aes(fertilizer, Yield)) + geom_point() + geom_smooth(method="glm")
```

```{r, cache=TRUE}
continents_data = 0
continents_data <- merged_data %>% filter(Entity %in% c("Africa", "Northern America", "Asia", "Europe", "Oceania", "South America"))

ggplot(continents_data, aes(fertilizer, Yield, color = Entity)) + geom_point()
ggplot(continents_data, aes(land, Yield, color = Entity)) + geom_point()
```

```{r, cache=TRUE}
ggplot(merged_data, aes(as.factor(Year), Yield)) + geom_boxplot()
```
```{r, cache=TRUE}
ggplot(continents_data, aes(as.factor(Entity), Yield)) + geom_boxplot()
```

```
full_merged_crops %>%
  filter(Entity %in% "Africa") %>%
  ggplot(aes(x = Year, y = yield)) + geom_point() + theme_bw() + geom_smooth(method = "glm")
```


### Data Dictionary

# `key_crop_yields.csv`

|variable                         |class     |description |
|:--------------------------------|:---------|:-----------|
|Entity                           |character | Country or Region Name |
|Code                             |character | Country Code (note is NA for regions/continents) |
|Year                             |double    | Year |
|Wheat (tonnes per hectare)       |double    | Wheat yield |
|Rice (tonnes per hectare)        |double    | Rice Yield |
|Maize (tonnes per hectare)       |double    | Maize yield |
|Soybeans (tonnes per hectare)    |double    | Soybeans yield |
|Potatoes (tonnes per hectare)    |double    | Potato yield |
|Beans (tonnes per hectare)       |double    | Beans yield|
|Peas (tonnes per hectare)        |double    | Peas yield |
|Cassava (tonnes per hectare)     |double    | Cassava (yuca) yield|
|Barley (tonnes per hectare)      |double    | Barley|
|Cocoa beans (tonnes per hectare) |double    | Cocoa |
|Bananas (tonnes per hectare)     |double    | Bananas |

# `arable_land`

|variable                                                               |class     |description |
|:----------------------------------------------------------------------|:---------|:-----------|
|Entity                           |character | Country or Region Name |
|Code                             |character | Country Code (note is NA for regions/continents) |
|Year                             |double    | Year |
|Arable land needed to produce a fixed quantity of crops ((1.0 = 1961)) |double    | Arable land normalized to 1961 |


# `fertilizer`

|variable                                        |class     |description |
|:-----------------------------------------------|:---------|:-----------|
|Entity                           |character | Country or Region Name |
|Code                             |character | Country Code (note is NA for regions/continents) |
|Year                             |double    | Year |
|Cereal yield (tonnes per hectare)               |double    | Cereal yield in tonnes per hectare |
|Nitrogen fertilizer use (kilograms per hectare) |double    | Nitrogen fertilizer use kg per hectare |

# `land_use`

|variable                                                  |class     |description |
|:---------------------------------------------------------|:---------|:-----------|
|Entity                           |character | Country or Region Name |
|Code                             |character | Country Code (note is NA for regions/continents) |
|Year                             |double    | Year |
|cereal yield index                                        |double    | Cereal yield index |
|change to land area used for cereal production since 1961 |double    | Change to land area use for cereal production relative since 1961|
|total population (gapminder)                              |double    | Total population from gapminder data |


